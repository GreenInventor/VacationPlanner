<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="ISO-8859-1">
	<title>Edit Plan</title>
	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta2/dist/css/bootstrap-select.min.css">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta2/dist/js/bootstrap-select.min.js"></script>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link th:href= "@{/css/dashboard.css}" rel="stylesheet">
	<link rel="icon" th:href="@{../img/letter-vp-triangle-logo-design-260nw-1324887731-modified-removebg-preview.png}">
<style>
.form-floating{
		padding-bottom: 5px;
		}
		*:focus {
    outline: none;
    border: none;
    }
    .customSelect{
  background-color: #f8f9fa;
}
		</style>
</head>
<body>
	<header class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow"> <!-- Top of page -->
 		<a class="navbar-brand col-md-3 col-lg-2 me-0 px-3" ><img th:src="@{../img/letter-vp-triangle-logo-design-260nw-1324887731-modified-removebg-preview.png}" width="30" height="30" class="d-inline-block align-top" alt=""> Vacation Planner</a>
   		   		<div class="navbar-nav ms-auto">
      		<a class="nav-link px-3" th:href="@{/userHome/{id}(id=${id})}">View Plans</a>
  		</div>
   		<div class="navbar-nav">
      		<a class="nav-link px-3" href="#">Account Settings</a>
  		</div>
  		<div class="navbar-nav">
    		<div class="nav-item text-nowrap">
      			<a class="nav-link px-3" href="/">Sign out</a>
    		</div>
  		</div>
	</header>

	<form th:object="${plan}" th:action="@{/editName/{id}(id=${id})}" method='POST'> <!-- Manage plan -->
		<div class="form-floating">
			<input style="text-align:center;" name="name" id="name" size="20" class="form-control" th:field="*{name}" required> <!-- Plan name -->
			<input type="hidden" name="id" id="id" th:value="*{id}" required>
		</div>
		<br>
		<input style ="width: 100%;" class="btn btn-warning btn-sm" type = "submit" value= "Edit Name" name= "action"> <!-- Edit Name button -->
	</form>
	<br>
	
	<table class="table text-center table-bordered caption-top"> <!-- Activities Section -->
		<tr>
			<th colspan ="3">Activities</th>
		</tr>
		<tr> <!-- List of Activities -->
			<td></td> 
			<td></td> 
			<td><form th:action="@{/deleteActivity/{id}(id=${id})}" method='POST'> <!-- Delete Activity -->
				<input style ="width: 100%;" class="btn btn-danger btn-sm" type = "submit" value= "Delete" name= "action">
			</form></td>
		</tr>
	</table>
	<a class="w-100 btn btn-lg btn-primary" th:href="@{/addActivity/{id}(id=${id})}">Add Activity</a>
	<br>
	<br>
	
	
	<script>
		function validateCar(form){
			let error = false
			let y = document.getElementsByClassName('customSelect');
			y[0].style.boxShadow = "none";
			document.getElementById("alert").style.display = "none";
			document.getElementById("alert1").style.display = "none";
			document.getElementById("alert2").style.display = "none";
			document.getElementById("alert3").style.display = "none";
			document.getElementById("startDate").style.boxShadow = "none";
			document.getElementById("endDate").style.boxShadow = "none";
			let startDate = form.startDate.value
			let endDate = form.endDate.value
			if(endDate ==""){
				document.getElementById("alert2").style.display = "block";
				document.getElementById("endDate").style.boxShadow = "0 0 0 0.2rem rgba(255, 0, 0, 0.25)";
				form.endDate.focus();
				error = true;
			}
			if(endDate < startDate && startDate != "" && endDate != ""){
				document.getElementById("alert3").style.display = "block";
				document.getElementById("endDate").style.boxShadow = "0 0 0 0.2rem rgba(255, 0, 0, 0.25)";
				form.endDate.focus();
				error = true;
			}
			if(startDate == ""){
				document.getElementById("alert1").style.display = "block";
				document.getElementById("startDate").style.boxShadow = "0 0 0 0.2rem rgba(255, 0, 0, 0.25)";
				form.startDate.focus();
				error = true;
			}
			if(form.state.value ==""){
				document.getElementById("alert").style.display = "block";
				document.getElementById("state").style.outline = "5px auto solid red";
				y[0].style.boxShadow = "0 0 0 0.2rem rgba(255, 0, 0, 0.25)";
				form.state.focus();
				error = true;
			}
			
			if(error == true) return false
			else return true;
			
			
			
		}
	</script>
	
	
	<table class="table text-center table-bordered caption-top" style = "margin-bottom:0px;"> <!-- Rental Car Section -->
		<tr>
			<th>Rental Car</th>
			<th>Dealership</th>
			<th>Phone Number</th>
			<th>Dealership Address</th>
			<th>Rental Start Date</th>
			<th>Rental End Date</th>
			<th>Total</th>
			<th>Cancel Rental</th>
		</tr>
		<tr th:each="currentCar : ${plan.carRentals}"> <!-- List of Rental cars -->
			<td th:text="${currentCar.car.year} + ' ' + ${currentCar.car.make} + ' ' + ${currentCar.car.model}"/> <!-- TODO format this better. Ex: 2020 Ford F150 (3/15/22 to 3/25/22) instead of only showing the make-->
			<td th:text="${currentCar.car.dealership.name}"/>
			<td th:text="${currentCar.car.dealership.phoneNumber}"/>
			<td th:text="${currentCar.car.dealership.address.street} + ' ' + ${currentCar.car.dealership.address.city} + ' ' + ${currentCar.car.dealership.address.state} + ' ' + ${currentCar.car.dealership.address.zip}"/>
			<td th:text="${#temporals.format(currentCar.rentalStartDate, 'MM/dd/yyyy')}"/>
			<td th:text="${#temporals.format(currentCar.rentalEndDate, 'MM/dd/yyyy')}"/>
			<td th:text="${#numbers.formatCurrency(currentCar.rentalTotal)}"/>
			<td><form th:action="@{/cancelRentalCar/{id}(id=${id})}" method='POST'> <!-- Delete Rental -->
			<input type="hidden" th:value="${currentCar.id}" name="rentalId"/>
			<input type="hidden" th:value="${plan.id}" name="planId"/>
				<input style ="width: 100%;" class="btn btn-danger btn-sm" type = "submit" value= "Delete" name= "action">
			</form></td>
		</tr>
	</table>
	<form th:object="${plan}" th:action="@{/addCar/{id}(id=${id})}"  method='POST' onsubmit="return validateCar(this);">
		<div class="form-floating">
			<select class="selectpicker form-control" data-live-search="true" title= "Select A State" name="state" id="state" data-style="customSelect" >
				<option value="AL">Alabama</option>
				<option value="AK">Alaska</option>
				<option value="AZ">Arizona</option>
				<option value="AR">Arkansas</option>
				<option value="CA">California</option>
				<option value="CO">Colorado</option>
				<option value="CT">Connecticut</option>
				<option value="DE">Delaware</option>
				<option value="FL">Florida</option>
				<option value="GA">Georgia</option>
				<option value="HI">Hawaii</option>
				<option value="ID">Idaho</option>
				<option value="IL">Illinois</option>
				<option value="IN">Indiana</option>
				<option value="IA">Iowa</option>
				<option value="KS">Kansas</option>
				<option value="KY">Kentucky</option>
				<option value="LA">Louisiana</option>
				<option value="ME">Maine</option>
				<option value="MD">Maryland</option>
				<option value="MA">Massachusetts</option>
				<option value="MI">Michigan</option>
				<option value="MN">Minnesota</option>
				<option value="MS">Mississippi</option>
				<option value="MO">Missouri</option>
				<option value="MT">Montana</option>
				<option value="NE">Nebraska</option>
				<option value="NV">Nevada</option>
				<option value="NH">New Hampshire</option>
				<option value="NJ">New Jersey</option>
				<option value="NM">New Mexico</option>
				<option value="NY">New York</option>
				<option value="NC">North Carolina</option>
				<option value="ND">North Dakota</option>
				<option value="OH">Ohio</option>
				<option value="OK">Oklahoma</option>
				<option value="OR">Oregon</option>
				<option value="PA">Pennsylvania</option>
				<option value="RI">Rhode Island</option>
				<option value="SC">South Carolina</option>
				<option value="SD">South Dakota</option>
				<option value="TN">Tennessee</option>
				<option value="TX">Texas</option>
				<option value="UT">Utah</option>
				<option value="VT">Vermont</option>
				<option value="VA">Virginia</option>
				<option value="WA">Washington</option>
				<option value="WV">West Virginia</option>
				<option value="WI">Wisconsin</option>
				<option value="WY">Wyoming</option>
			</select>
		</div>
		<p id="alert" class="alert alert-danger" style="display: none; margin-top: 6px; margin-bottom: 0px;">State Field Must Not Be Empty!</p>
		<br>
		<div class="row" style = "margin:1px;">
			<div class="form-floating col">
				<input type="date" name="startDate" id="startDate" size="20" class="form-control"> 
				<label for="startDate">Start Date</label>
			</div>
			
			<div class="form-floating col">
				<input type="date" name="endDate" id="endDate" size="20" class="form-control"> 
				<label for="endDate">End Date</label>
			</div>
			<p id="alert1" class="alert alert-danger" style="display: none; margin-top: 6px;">Start Date Field Must Not Be Empty!</p>
			<p id="alert2" class="alert alert-danger" style="display: none; margin-top: 6px;">End Date Field Must Not Be Empty!</p>
			<p id="alert3" class="alert alert-danger" style="display: none; margin-top: 6px;">End Date Can Not Be Before Start Date!</p>
		</div>
		<br>
		<input name="id" id="id" type="hidden" th:field="*{id}" required>
		<input class="w-100 btn btn-lg btn-primary" name="submit" type="submit" value="See Available Cars" />
	</form>
	<br>
	
	<table class="table text-center table-bordered caption-top" style = "margin-bottom:0px;"> <!-- Hotels Section -->
		<tr>
			<th colspan ="3">Hotels</th>
		</tr>
		<tr th:each="currentHotel : ${hotels}"> <!-- List of Hotels -->
			<td><p th:text="${currentHotel.hotelName}"/></td> <!-- TODO format this better. Ex: Marriot, Room 120 (123 Maple St., Des Moines, Iowa) instead of only showing the name-->
			<td><form th:action="@{/editHotel/{id}(id=${id})}" method='POST'> <!-- Edit Hotel -->
				<input style ="width: 100%;" class="btn btn-warning btn-sm" type = "submit" value= "Edit" name= "action">
			</form></td>
			<td><form th:action="@{/deleteHotel/{id}(id=${id})}" method='POST'> <!-- Delete Hotel -->
				<input style ="width: 100%;" class="btn btn-danger btn-sm" type = "submit" value= "Delete" name= "action">
			</form></td>
		</tr>
	</table>
	<form th:action="@{/addHotel/{id}(id=${id})}" method='POST'>
		<div class="form-floating">
			<select class="selectpicker form-control" data-live-search="true" title= "Select A State" name="state" id="state" required>
				<option value="AL">Alabama</option>
				<option value="AK">Alaska</option>
				<option value="AZ">Arizona</option>
				<option value="AR">Arkansas</option>
				<option value="CA">California</option>
				<option value="CO">Colorado</option>
				<option value="CT">Connecticut</option>
				<option value="DE">Delaware</option>
				<option value="FL">Florida</option>
				<option value="GA">Georgia</option>
				<option value="HI">Hawaii</option>
				<option value="ID">Idaho</option>
				<option value="IL">Illinois</option>
				<option value="IN">Indiana</option>
				<option value="IA">Iowa</option>
				<option value="KS">Kansas</option>
				<option value="KY">Kentucky</option>
				<option value="LA">Louisiana</option>
				<option value="ME">Maine</option>
				<option value="MD">Maryland</option>
				<option value="MA">Massachusetts</option>
				<option value="MI">Michigan</option>
				<option value="MN">Minnesota</option>
				<option value="MS">Mississippi</option>
				<option value="MO">Missouri</option>
				<option value="MT">Montana</option>
				<option value="NE">Nebraska</option>
				<option value="NV">Nevada</option>
				<option value="NH">New Hampshire</option>
				<option value="NJ">New Jersey</option>
				<option value="NM">New Mexico</option>
				<option value="NY">New York</option>
				<option value="NC">North Carolina</option>
				<option value="ND">North Dakota</option>
				<option value="OH">Ohio</option>
				<option value="OK">Oklahoma</option>
				<option value="OR">Oregon</option>
				<option value="PA">Pennsylvania</option>
				<option value="RI">Rhode Island</option>
				<option value="SC">South Carolina</option>
				<option value="SD">South Dakota</option>
				<option value="TN">Tennessee</option>
				<option value="TX">Texas</option>
				<option value="UT">Utah</option>
				<option value="VT">Vermont</option>
				<option value="VA">Virginia</option>
				<option value="WA">Washington</option>
				<option value="WV">West Virginia</option>
				<option value="WI">Wisconsin</option>
				<option value="WY">Wyoming</option>
			</select>
		</div>
		<br>
		<div class="row" style = "margin:1px;">
			<div class="form-floating col">
				<input type="date" name="startDate" id="startDate" size="20" class="form-control" required> 
				<label for="startDate">Start Date</label>
			</div>
			<div class="form-floating col">
				<input type="date" name="endDate" id="endDate" size="20" class="form-control" required> 
				<label for="endDate">End Date</label>
			</div>
		</div>
		<br>
		<input class="w-100 btn btn-lg btn-primary" name="submit" type="submit" value="Add Hotel" />
	</form>
	
	<table class="table text-center table-bordered caption-top"> <!-- Destinations Section -->
		<tr>
			<th colspan ="3">Destinations</th>
		</tr>
		<tr> <!-- List of Destinations -->
			<td></td>
			<td></td>
			<td><form th:action="@{/deleteDestination/{id}(id=${id})}" method='POST'> <!-- Delete Destination -->
				<input style ="width: 100%;" class="btn btn-danger btn-sm" type = "submit" value= "Delete" name= "action">
			</form></td>
		</tr>
	</table>
	<a class="w-100 btn btn-lg btn-primary" th:href="@{/addDestination/{id}(id=${id})}">Add Destination</a>
	<br>
	<br>
</body>
</html>